<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>URIGenerator.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Orne Test Generators</a> &gt; <a href="index.source.html" class="el_package">dev.orne.test.rnd.generators</a> &gt; <span class="el_source">URIGenerator.java</span></div><h1>URIGenerator.java</h1><pre class="source lang-java linenums">package dev.orne.test.rnd.generators;

/*-
 * #%L
 * Orne Test Generators
 * %%
 * Copyright (C) 2022 Orne Developments
 * %%
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Lesser Public License for more details.
 * 
 * You should have received a copy of the GNU General Lesser Public
 * License along with this program.  If not, see
 * &lt;http://www.gnu.org/licenses/lgpl-3.0.html&gt;.
 * #L%
 */

import java.net.URI;
import java.net.URISyntaxException;

import javax.validation.constraints.NotNull;

import org.apache.commons.lang3.RandomStringUtils;
import org.apache.commons.lang3.RandomUtils;
import org.apiguardian.api.API;
import org.apiguardian.api.API.Status;

import dev.orne.test.rnd.AbstractTypedGenerator;
import dev.orne.test.rnd.GenerationException;
import dev.orne.test.rnd.Priority;

/**
 * Generator of {@code URI} values.
 * 
 * @author &lt;a href=&quot;mailto:wamphiry@orne.dev&quot;&gt;(w) Iker Hernaez&lt;/a&gt;
 * @version 1.0, 2022-11
 * @since 0.1
 * @see &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc2732&quot;&gt;RFC 2732&lt;/a&gt;
 * @see &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc2373&quot;&gt;RFC 2373&lt;/a&gt;
 */
@API(status=Status.STABLE, since=&quot;0.1&quot;)
@Priority(Priority.NATIVE_GENERATORS)
public class URIGenerator
extends AbstractTypedGenerator&lt;URI&gt; {

    /** The default value. */
<span class="fc" id="L54">    public static final URI DEFAULT_VALUE = URI.create(&quot;/&quot;);</span>
    
    private static final String LOWALPHA = &quot;abcdefghijklmnopqrstuvwxyz&quot;;
    private static final String UPALPHA = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;;
    private static final String ALPHA = LOWALPHA + UPALPHA;
    private static final String DIGIT = &quot;0123456789&quot;;
    private static final String ALPHANUM = ALPHA + DIGIT;
    private static final String RESERVED = &quot;;/?@&amp;=+$,[]&quot;; // Removed ':'
    private static final String MARK = &quot;-_.!~*'()&quot;;
    private static final String UNRESERVED  = ALPHANUM + MARK;
    private static final String HEXDIG = DIGIT + &quot;ABCDEF&quot;;
    private static final float ESCAPED_CHAR_P = 0.05f;
    private static final String UNESCAPED_URIC = RESERVED + UNRESERVED;
    private static final int SCHEME_MIN_LENGTH = 1;
    private static final int SCHEME_MAX_LENGTH = 10;
    private static final String SCHEME_REST_C = ALPHANUM + &quot;+-.&quot;;
    private static final int USERINFO_MIN_LENGTH = 0;
    private static final int USERINFO_MAX_LENGTH = 20;
    private static final String UNESCAPED_USERINFO_C = UNRESERVED + &quot;;&amp;=+$,&quot;; // Removed ':'
    private static final int DOMAIN_LABEL_MIN_LENGTH = 1;
    private static final int DOMAIN_LABEL_MAX_LENGTH = 20;
    private static final String DOMAIN_LABEL_MIDDLE_C = ALPHANUM + &quot;-&quot;;
    private static final int TOP_LABEL_MIN_LENGTH = 1;
    private static final int TOP_LABEL_MAX_LENGTH = 5;
    private static final String TOP_LABEL_MIDDLE_C = ALPHANUM + &quot;-&quot;;
    private static final int HOSTNAME_MIN_DOMAIN_LEVELS = 1;
    private static final int HOSTNAME_MAX_DOMAIN_LEVELS = 5;
    private static final char DOMAIN_LABEL_SEPARATOR = '.';
    private static final float TOP_LABEL_SUFFIX_P = 0.01f;
    private static final char TOP_LABEL_SUFFIX = '.';
    private static final int IP4_ADDRESS_MIN_NUM = 0;
    private static final int IP4_ADDRESS_MAX_NUM = 255;
    private static final int IP6_PIECE_MIN_LENGTH = 1;
    private static final int IP6_PIECE_MAX_LENGTH = 4;
    private static final int IP6_ADDRESS_MIN_LENGTH = 0;
    private static final int IP6_ADDRESS_MAX_LENGTH = 8;
    private static final float IP6_ABRV_P = 0.3f;
    private static final char IP6_ADDRESS_SEPARATOR = ':';
    private static final char IP6_ADDRESS_PREFIX = '[';
    private static final char IP6_ADDRESS_SUFFIX = ']';
    private static final float HOSTNAME_P = 0.8f;
    private static final float IP4_P = 0.5f;
    private static final int PORT_MIN = 1;
    private static final int PORT_MAX = 65535;
    private static final float PORT_P = 0.2f;
    private static final char PORT_PREFIX = ':';
    private static final char USERINFO_SUFFIX = '@';
    private static final float USERINFO_P = 0.2f;
    private static final int REG_NAME_MIN_LENGTH = 1;
    private static final int REG_NAME_MAX_LENGTH = 30;
    private static final String UNESCAPED_REG_NAME_C = UNRESERVED + &quot;$,;@&amp;=+&quot;; // Removed ':'
    private static final float SERVER_P = 0.9f;
    private static final String UNESCAPED_PATH_C = UNRESERVED + &quot;@&amp;=+$,&quot;; // Removed ':'
    private static final int PARAM_MIN_LENGTH = 1;
    private static final int PARAM_MAX_LENGTH = 10;
    private static final int SEGMENT_PATH_MIN_LENGTH = 1;
    private static final int SEGMENT_PATH_MAX_LENGTH = 20;
    private static final float SEGMENT_PARAM_P = 0.1f;
    private static final char SEGMENT_PARAM_SEPARATOR = ';';
    private static final int PATH_SEGMENTS_MIN_SEGMENTS = 0;
    private static final int PATH_SEGMENTS_MAX_SEGMENTS = 10;
    private static final char PATH_SEGMENTS_SEPARATOR = '/';
    private static final char ABSOLUTE_PATH_PREFIX = '/';
    private static final int QUERY_MIN_LENGTH = 1;
    private static final int QUERY_MAX_LENGTH = 50;
    private static final float QUERY_P = 0.5f;
    private static final float PATH_ABSOLUTE_P = 0.8f;
    private static final int FRAGMENT_MIN_LENGTH = 1;
    private static final int FRAGMENT_MAX_LENGTH = 20;
    private static final String UNESCAPED_RELATIVE_SEGMENT_C = UNRESERVED + &quot;;@&amp;=+$,&quot;;
    private static final int RELATIVE_SEGMENT_MIN_LENGTH = 1;
    private static final int RELATIVE_SEGMENT_MAX_LENGTH = 20;
    private static final float RELATIVE_PATH_ABSOLUTE_PATH_P = 0.6f;
    private static final float FRAGMENT_P = 0.2f;

    /**
     * Creates a new instance.
     */
    public URIGenerator() {
<span class="fc" id="L133">        super();</span>
<span class="fc" id="L134">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public @NotNull URI defaultValue() {
<span class="fc" id="L141">        return DEFAULT_VALUE;</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public @NotNull URI randomValue() {
<span class="fc" id="L149">        return randomURI();</span>
    }

    /**
     * Returns a random scheme.
     * 
     * @return The random scheme
     */
    public static @NotNull String randomScheme() {
<span class="fc" id="L158">        final int length = RandomUtils.nextInt(</span>
                SCHEME_MIN_LENGTH,
                SCHEME_MAX_LENGTH + 1);
<span class="fc" id="L161">        final StringBuilder buffer = new StringBuilder();</span>
<span class="fc" id="L162">        buffer.append(RandomStringUtils.randomAlphabetic(1));</span>
<span class="fc" id="L163">        buffer.append(RandomStringUtils.random(length - 1, SCHEME_REST_C));</span>
<span class="fc" id="L164">        return buffer.toString();</span>
    }

    /**
     * Returns a random user info part of an URI.
     * 
     * @return The random user info
     */
    public static @NotNull String randomUserInfo() {
<span class="fc" id="L173">        final int length = RandomUtils.nextInt(</span>
                USERINFO_MIN_LENGTH,
                USERINFO_MAX_LENGTH + 1);
<span class="fc" id="L176">        final StringBuilder buffer = new StringBuilder();</span>
<span class="fc bfc" id="L177" title="All 2 branches covered.">        for (int i = 0; i &lt; length; i++) {</span>
<span class="fc bfc" id="L178" title="All 2 branches covered.">            if (RandomUtils.nextFloat(0, 1) &lt; ESCAPED_CHAR_P) {</span>
<span class="fc" id="L179">                buffer.append((char) RandomUtils.nextInt('\u0080', '\uFFFF'));</span>
            } else {
<span class="fc" id="L181">                buffer.append(RandomStringUtils.random(1, UNESCAPED_USERINFO_C));</span>
            }
        }
<span class="fc" id="L184">        return buffer.toString();</span>
    }

    /**
     * Returns a random optional user info part of an URI.
     * 
     * @return The random user info, or {@code null}
     */
    public static String randomOptionalUserInfo() {
<span class="fc bfc" id="L193" title="All 2 branches covered.">        if (RandomUtils.nextFloat(0, 1) &lt; USERINFO_P) {</span>
<span class="fc" id="L194">            return randomUserInfo();</span>
        } else {
<span class="fc" id="L196">            return null;</span>
        }
    }

    /**
     * Returns a random non top domain label.
     * 
     * @return The non top domain label
     */
    protected static @NotNull String randomDomainLabel() {
<span class="fc" id="L206">        final StringBuilder buffer = new StringBuilder();</span>
<span class="fc" id="L207">        final int length = RandomUtils.nextInt(</span>
                DOMAIN_LABEL_MIN_LENGTH,
                DOMAIN_LABEL_MAX_LENGTH + 1);
<span class="fc" id="L210">        buffer.append(RandomStringUtils.randomAlphanumeric(1));</span>
<span class="fc bfc" id="L211" title="All 2 branches covered.">        if (length &gt; 1) {</span>
<span class="fc bfc" id="L212" title="All 2 branches covered.">            if (length &gt; 2) {</span>
<span class="fc" id="L213">                buffer.append(RandomStringUtils.random(length - 2, DOMAIN_LABEL_MIDDLE_C));</span>
            }
<span class="fc" id="L215">            buffer.append(RandomStringUtils.randomAlphanumeric(1));</span>
        }
<span class="fc" id="L217">        return buffer.toString();</span>
    }

    /**
     * Returns a random top domain label.
     * 
     * @return The top domain label
     */
    protected static @NotNull String randomTopLabel() {
<span class="fc" id="L226">        final StringBuilder buffer = new StringBuilder();</span>
<span class="fc" id="L227">        final int length = RandomUtils.nextInt(</span>
                TOP_LABEL_MIN_LENGTH,
                TOP_LABEL_MAX_LENGTH + 1);
<span class="fc" id="L230">        buffer.append(RandomStringUtils.randomAlphabetic(1));</span>
<span class="fc bfc" id="L231" title="All 2 branches covered.">        if (length &gt; 1) {</span>
<span class="fc bfc" id="L232" title="All 2 branches covered.">            if (length &gt; 2) {</span>
<span class="fc" id="L233">                buffer.append(RandomStringUtils.random(length - 2, TOP_LABEL_MIDDLE_C));</span>
            }
<span class="fc" id="L235">            buffer.append(RandomStringUtils.randomAlphanumeric(1));</span>
        }
<span class="fc" id="L237">        return buffer.toString();</span>
    }

    /**
     * Returns a random host name.
     * 
     * @return The host name
     */
    public static @NotNull String randomHostName() {
<span class="fc" id="L246">        final StringBuilder buffer = new StringBuilder();</span>
<span class="fc" id="L247">        final int domainLevels = RandomUtils.nextInt(</span>
                HOSTNAME_MIN_DOMAIN_LEVELS,
                HOSTNAME_MAX_DOMAIN_LEVELS + 1);
<span class="fc bfc" id="L250" title="All 2 branches covered.">        for (int i = 0; i &lt; domainLevels; i++) {</span>
<span class="fc" id="L251">            buffer.append(randomDomainLabel()).append(DOMAIN_LABEL_SEPARATOR);</span>
        }
<span class="fc" id="L253">        buffer.append(randomTopLabel());</span>
<span class="pc bpc" id="L254" title="1 of 2 branches missed.">        if (RandomUtils.nextFloat(0, 1) &lt; TOP_LABEL_SUFFIX_P) {</span>
<span class="nc" id="L255">            buffer.append(TOP_LABEL_SUFFIX);</span>
        }
<span class="fc" id="L257">        return buffer.toString();</span>
    }

    /**
     * Returns a random IP4 address.
     * 
     * @return The IP4 address
     */
    public static @NotNull String randomIp4Address() {
<span class="fc" id="L266">        return String.format(</span>
                &quot;%d.%d.%d.%d&quot;,
<span class="fc" id="L268">                RandomUtils.nextInt(IP4_ADDRESS_MIN_NUM, IP4_ADDRESS_MAX_NUM + 1),</span>
<span class="fc" id="L269">                RandomUtils.nextInt(IP4_ADDRESS_MIN_NUM, IP4_ADDRESS_MAX_NUM + 1),</span>
<span class="fc" id="L270">                RandomUtils.nextInt(IP4_ADDRESS_MIN_NUM, IP4_ADDRESS_MAX_NUM + 1),</span>
<span class="fc" id="L271">                RandomUtils.nextInt(IP4_ADDRESS_MIN_NUM, IP4_ADDRESS_MAX_NUM + 1));</span>
    }

    /**
     * Returns a random IP6 address piece.
     * 
     * @return The random IP6 address piece
     */
    protected static @NotNull String randomIp6Piece() {
<span class="fc" id="L280">        final int length = RandomUtils.nextInt(</span>
                IP6_PIECE_MIN_LENGTH,
                IP6_PIECE_MAX_LENGTH + 1);
<span class="fc" id="L283">        return RandomStringUtils.random(length, HEXDIG);</span>
    }

    /**
     * Returns a random full IP6 address.
     * 
     * @return The full IP6 address
     */
    public static @NotNull String randomFullIp6Address() {
<span class="fc" id="L292">        return String.format(</span>
                &quot;%s:%s:%s:%s:%s:%s:%s:%s&quot;,
<span class="fc" id="L294">                randomIp6Piece(),</span>
<span class="fc" id="L295">                randomIp6Piece(),</span>
<span class="fc" id="L296">                randomIp6Piece(),</span>
<span class="fc" id="L297">                randomIp6Piece(),</span>
<span class="fc" id="L298">                randomIp6Piece(),</span>
<span class="fc" id="L299">                randomIp6Piece(),</span>
<span class="fc" id="L300">                randomIp6Piece(),</span>
<span class="fc" id="L301">                randomIp6Piece());</span>
    }

    /**
     * Returns a random abbreviated IP6 address.
     * 
     * @return The abbreviated IP6 address
     */
    public static @NotNull String randomAbbreviatedIp6Address() {
<span class="fc" id="L310">        final StringBuilder buffer = new StringBuilder();</span>
<span class="fc" id="L311">        final int pieces = RandomUtils.nextInt(</span>
                IP6_ADDRESS_MIN_LENGTH,
                IP6_ADDRESS_MAX_LENGTH);
<span class="pc bpc" id="L314" title="1 of 2 branches missed.">        if (pieces == 0) {</span>
<span class="nc" id="L315">            buffer.append(IP6_ADDRESS_SEPARATOR)</span>
<span class="nc" id="L316">                    .append(IP6_ADDRESS_SEPARATOR);</span>
        } else {
<span class="fc" id="L318">            final int prePieces = RandomUtils.nextInt(0, pieces + 1);</span>
<span class="pc bpc" id="L319" title="1 of 2 branches missed.">            if (prePieces &gt; 0) {</span>
<span class="nc" id="L320">                buffer.append(randomIp6Piece());</span>
<span class="nc bnc" id="L321" title="All 2 branches missed.">                for (int i = 1 ; i &lt; prePieces; i++) {</span>
<span class="nc" id="L322">                    buffer.append(IP6_ADDRESS_SEPARATOR).append(randomIp6Piece());</span>
                }
            }
<span class="fc" id="L325">            buffer.append(IP6_ADDRESS_SEPARATOR);</span>
<span class="fc" id="L326">            final int postPieces = pieces - prePieces;</span>
<span class="pc bpc" id="L327" title="1 of 2 branches missed.">            if (postPieces == 0) {</span>
<span class="nc" id="L328">                buffer.append(IP6_ADDRESS_SEPARATOR);</span>
            } else {
<span class="fc bfc" id="L330" title="All 2 branches covered.">                for (int i = 0 ; i &lt; postPieces; i++) {</span>
<span class="fc" id="L331">                    buffer.append(IP6_ADDRESS_SEPARATOR).append(randomIp6Piece());</span>
                }
            }
        }
<span class="fc" id="L335">        return buffer.toString();</span>
    }

    /**
     * Returns a random IP6 address.
     * 
     * @return The IP6 address
     */
    public static @NotNull String randomIp6Address() {
<span class="fc bfc" id="L344" title="All 2 branches covered.">        if (RandomUtils.nextFloat(0, 1) &lt; IP6_ABRV_P) {</span>
<span class="fc" id="L345">            return randomAbbreviatedIp6Address();</span>
        } else {
<span class="fc" id="L347">            return randomFullIp6Address();</span>
        }
    }

    /**
     * Returns a random host.
     * 
     * @return The host part
     */
    public static @NotNull String randomHost() {
<span class="fc bfc" id="L357" title="All 2 branches covered.">        if (RandomUtils.nextFloat(0, 1) &lt; HOSTNAME_P) {</span>
<span class="fc" id="L358">            return randomHostName();</span>
<span class="fc bfc" id="L359" title="All 2 branches covered.">        } else if (RandomUtils.nextFloat(0, 1) &lt; IP4_P) {</span>
<span class="fc" id="L360">            return randomIp4Address();</span>
        } else {
<span class="fc" id="L362">            return IP6_ADDRESS_PREFIX + randomIp6Address() + IP6_ADDRESS_SUFFIX;</span>
        }
    }

    /**
     * Returns a random port.
     * 
     * @return The port
     */
    public static int randomPort() {
<span class="fc" id="L372">        return RandomUtils.nextInt(PORT_MIN, PORT_MAX + 1);</span>
    }

    /**
     * Returns a random optional port.
     * 
     * @return The port, or {@code -1}
     */
    public static int randomOptionalPort() {
<span class="fc bfc" id="L381" title="All 2 branches covered.">        if (RandomUtils.nextFloat(0, 1) &lt; PORT_P) {</span>
<span class="fc" id="L382">            return randomPort();</span>
        } else {
<span class="fc" id="L384">            return -1;</span>
        }
    }

    /**
     * Returns a random server authority part.
     * 
     * @return The server authority part
     */
    public static @NotNull String randomServerAuthority() {
<span class="fc" id="L394">        final StringBuilder buffer = new StringBuilder();</span>
<span class="fc" id="L395">        final String userInfo = randomOptionalUserInfo();</span>
<span class="fc" id="L396">        final String host = randomHost();</span>
<span class="fc" id="L397">        final int port = randomOptionalPort();</span>
<span class="fc bfc" id="L398" title="All 2 branches covered.">        if (userInfo != null) {</span>
<span class="fc" id="L399">            buffer.append(userInfo).append(USERINFO_SUFFIX);</span>
        }
<span class="fc" id="L401">        buffer.append(host);</span>
<span class="fc bfc" id="L402" title="All 2 branches covered.">        if (port != -1) {</span>
<span class="fc" id="L403">            buffer.append(PORT_PREFIX).append(port);</span>
        }
<span class="fc" id="L405">        return buffer.toString();</span>
    }

    /**
     * Returns a random registry based named authority part.
     * 
     * @return The registry based named authority part
     */
    public static @NotNull String randomRegistryBasedNamedAuthority() {
<span class="fc" id="L414">        final StringBuilder buffer = new StringBuilder();</span>
<span class="fc" id="L415">        final int length = RandomUtils.nextInt(</span>
                REG_NAME_MIN_LENGTH,
                REG_NAME_MAX_LENGTH + 1);
<span class="fc bfc" id="L418" title="All 2 branches covered.">        for (int i = 0; i &lt; length; i++) {</span>
<span class="fc bfc" id="L419" title="All 2 branches covered.">            if (RandomUtils.nextFloat(0, 1) &lt; ESCAPED_CHAR_P) {</span>
<span class="fc" id="L420">                buffer.append((char) RandomUtils.nextInt('\u0080', '\uFFFF'));</span>
            } else {
<span class="fc" id="L422">                buffer.append(RandomStringUtils.random(1, UNESCAPED_REG_NAME_C));</span>
            }
        }
<span class="fc" id="L425">        return buffer.toString();</span>
    }

    /**
     * Returns a random authority part.
     * 
     * @return The authority part
     */
    public static @NotNull String randomAuthority() {
<span class="fc bfc" id="L434" title="All 2 branches covered.">        if (RandomUtils.nextFloat(0, 1) &lt; SERVER_P) {</span>
<span class="fc" id="L435">            return randomServerAuthority();</span>
        } else {
<span class="fc" id="L437">            return randomRegistryBasedNamedAuthority();</span>
        }
    }

    /**
     * Returns a random path segment.
     * 
     * @return The path segment
     */
    protected static @NotNull String randomPathSegment() {
<span class="fc" id="L447">        final StringBuilder buffer = new StringBuilder();</span>
<span class="fc" id="L448">        final int length = RandomUtils.nextInt(</span>
                SEGMENT_PATH_MIN_LENGTH,
                SEGMENT_PATH_MAX_LENGTH + 1);
<span class="fc" id="L451">        buffer.append(RandomStringUtils.randomAlphabetic(1));</span>
<span class="fc bfc" id="L452" title="All 2 branches covered.">        for (int i = 1; i &lt; length; i++) {</span>
<span class="fc bfc" id="L453" title="All 2 branches covered.">            if (RandomUtils.nextFloat(0, 1) &lt; ESCAPED_CHAR_P) {</span>
<span class="fc" id="L454">                buffer.append((char) RandomUtils.nextInt('\u0080', '\uFFFF'));</span>
            } else {
<span class="fc" id="L456">                buffer.append(RandomStringUtils.random(1, UNESCAPED_PATH_C));</span>
            }
        }
<span class="fc bfc" id="L459" title="All 2 branches covered.">        if (RandomUtils.nextFloat(0, 1) &lt; SEGMENT_PARAM_P) {</span>
<span class="fc" id="L460">            buffer.append(SEGMENT_PARAM_SEPARATOR);</span>
<span class="fc" id="L461">            final int paramLength = RandomUtils.nextInt(</span>
                    PARAM_MIN_LENGTH,
                    PARAM_MAX_LENGTH + 1);
<span class="fc bfc" id="L464" title="All 2 branches covered.">            for (int i = 0; i &lt; paramLength; i++) {</span>
<span class="fc bfc" id="L465" title="All 2 branches covered.">                if (RandomUtils.nextFloat(0, 1) &lt; ESCAPED_CHAR_P) {</span>
<span class="fc" id="L466">                    buffer.append((char) RandomUtils.nextInt('\u0080', '\uFFFF'));</span>
                } else {
<span class="fc" id="L468">                    buffer.append(RandomStringUtils.random(1, UNESCAPED_PATH_C));</span>
                }
            }
        }
<span class="fc" id="L472">        return buffer.toString();</span>
    }

    /**
     * Returns a random absolute path.
     * 
     * @return The absolute path
     */
    public static @NotNull String randomAbsolutePath() {
<span class="fc" id="L481">        final StringBuilder buffer = new StringBuilder();</span>
<span class="fc" id="L482">        buffer.append(ABSOLUTE_PATH_PREFIX);</span>
<span class="fc" id="L483">        final int length = RandomUtils.nextInt(</span>
                PATH_SEGMENTS_MIN_SEGMENTS,
                PATH_SEGMENTS_MAX_SEGMENTS + 1);
<span class="fc bfc" id="L486" title="All 2 branches covered.">        if (length &gt; 0) {</span>
<span class="fc" id="L487">            buffer.append(randomPathSegment());</span>
<span class="fc bfc" id="L488" title="All 2 branches covered.">            for (int i = 1; i &lt; length; i++) {</span>
<span class="fc" id="L489">                buffer.append(PATH_SEGMENTS_SEPARATOR).append(randomPathSegment());</span>
            }
        }
<span class="fc" id="L492">        return buffer.toString();</span>
    }

    /**
     * Returns a random relative path.
     * 
     * @return The relative path
     */
    public static @NotNull String randomRelativePath() {
<span class="fc" id="L501">        final StringBuilder buffer = new StringBuilder();</span>
<span class="fc" id="L502">        final int length = RandomUtils.nextInt(</span>
                RELATIVE_SEGMENT_MIN_LENGTH,
                RELATIVE_SEGMENT_MAX_LENGTH + 1);
<span class="fc bfc" id="L505" title="All 2 branches covered.">        for (int i = 0; i &lt; length; i++) {</span>
<span class="fc bfc" id="L506" title="All 2 branches covered.">            if (RandomUtils.nextFloat(0, 1) &lt; ESCAPED_CHAR_P) {</span>
<span class="fc" id="L507">                buffer.append((char) RandomUtils.nextInt('\u0080', '\uFFFF'));</span>
            } else {
<span class="fc" id="L509">                buffer.append(RandomStringUtils.random(1, UNESCAPED_RELATIVE_SEGMENT_C));</span>
            }
        }
<span class="fc bfc" id="L512" title="All 2 branches covered.">        if (RandomUtils.nextFloat(0, 1) &lt; RELATIVE_PATH_ABSOLUTE_PATH_P) {</span>
<span class="fc" id="L513">            buffer.append(randomAbsolutePath());</span>
        }
<span class="fc" id="L515">        return buffer.toString();</span>
    }

    /**
     * Returns a random path part of an URI.
     * The path can be relative or absolute.
     * 
     * @return The path part
     */
    public static @NotNull String randomPath() {
<span class="nc bnc" id="L525" title="All 2 branches missed.">        if (RandomUtils.nextFloat(0, 1) &lt; PATH_ABSOLUTE_P) {</span>
<span class="nc" id="L526">            return randomAbsolutePath();</span>
        } else {
<span class="nc" id="L528">            return randomRelativePath();</span>
        }
    }

    /**
     * Returns a random query part of an URI.
     * 
     * @return The query part
     */
    public static @NotNull String randomQuery() {
<span class="fc" id="L538">        final StringBuilder buffer = new StringBuilder();</span>
<span class="fc" id="L539">        final int length = RandomUtils.nextInt(</span>
                QUERY_MIN_LENGTH,
                QUERY_MAX_LENGTH + 1);
<span class="fc bfc" id="L542" title="All 2 branches covered.">        for (int i = 0; i &lt; length; i++) {</span>
<span class="fc bfc" id="L543" title="All 2 branches covered.">            if (RandomUtils.nextFloat(0, 1) &lt; ESCAPED_CHAR_P) {</span>
<span class="fc" id="L544">                buffer.append((char) RandomUtils.nextInt('\u0080', '\uFFFF'));</span>
            } else {
<span class="fc" id="L546">                buffer.append(RandomStringUtils.random(1, UNESCAPED_URIC));</span>
            }
        }
<span class="fc" id="L549">        return buffer.toString();</span>
    }

    /**
     * Returns a random optional query part of an URI.
     * 
     * @return The query part, or {@code null}
     */
    public static String randomOptionalQuery() {
<span class="fc bfc" id="L558" title="All 2 branches covered.">        if (RandomUtils.nextFloat(0, 1) &lt; QUERY_P) {</span>
<span class="fc" id="L559">            return randomQuery();</span>
        } else {
<span class="fc" id="L561">            return null;</span>
        }
    }

    /**
     * Returns a random fragment part of an URI.
     * 
     * @return The fragment part
     */
    public static @NotNull String randomFragment() {
<span class="fc" id="L571">        final StringBuilder buffer = new StringBuilder();</span>
<span class="fc" id="L572">        final int length = RandomUtils.nextInt(</span>
                FRAGMENT_MIN_LENGTH,
                FRAGMENT_MAX_LENGTH + 1);
<span class="fc bfc" id="L575" title="All 2 branches covered.">        for (int i = 0; i &lt; length; i++) {</span>
<span class="fc bfc" id="L576" title="All 2 branches covered.">            if (RandomUtils.nextFloat(0, 1) &lt; ESCAPED_CHAR_P) {</span>
<span class="fc" id="L577">                buffer.append((char) RandomUtils.nextInt('\u0080', '\uFFFF'));</span>
            } else {
<span class="fc" id="L579">                buffer.append(RandomStringUtils.random(1, UNESCAPED_URIC));</span>
            }
        }
<span class="fc" id="L582">        return buffer.toString();</span>
    }

    /**
     * Returns a random optional fragment part of an URI.
     * 
     * @return The fragment part, or {@code null}
     */
    public static String randomOptionalFragment() {
<span class="fc bfc" id="L591" title="All 2 branches covered.">        if (RandomUtils.nextFloat(0, 1) &lt; FRAGMENT_P) {</span>
<span class="fc" id="L592">            return randomFragment();</span>
        } else {
<span class="fc" id="L594">            return null;</span>
        }
    }

    /**
     * Returns a random absolute URI.
     * 
     * @return The absolute URI
     */
    public static @NotNull URI randomRelativeURI() {
        final String path;
<span class="fc bfc" id="L605" title="All 2 branches covered.">        if (RandomUtils.nextFloat(0, 1) &lt; PATH_ABSOLUTE_P) {</span>
<span class="fc" id="L606">            path = randomAbsolutePath();</span>
        } else {
<span class="fc" id="L608">            path = randomRelativePath();</span>
        }
        try {
<span class="fc" id="L611">            return new URI(</span>
                    null,
                    null,
                    path,
<span class="fc" id="L615">                    randomOptionalQuery(),</span>
<span class="fc" id="L616">                    randomOptionalFragment());</span>
<span class="nc" id="L617">        } catch (final URISyntaxException e) {</span>
<span class="nc" id="L618">            throw new GenerationException(&quot;Error generating URI&quot;, e);</span>
        }
    }

    /**
     * Returns a random absolute URI.
     * 
     * @return The absolute URI
     */
    public static @NotNull URI randomAbsoluteURI() {
        try {
<span class="fc" id="L629">            return new URI(</span>
<span class="fc" id="L630">                    randomScheme(),</span>
<span class="fc" id="L631">                    randomAuthority(),</span>
<span class="fc" id="L632">                    randomAbsolutePath(),</span>
<span class="fc" id="L633">                    randomOptionalQuery(),</span>
<span class="fc" id="L634">                    randomOptionalFragment());</span>
<span class="nc" id="L635">        } catch (final URISyntaxException e) {</span>
<span class="nc" id="L636">            throw new GenerationException(&quot;Error generating URI&quot;, e);</span>
        }
    }

    /**
     * Returns a random URI (absolute or not).
     * 
     * @return The URI
     */
    public static @NotNull URI randomURI() {
<span class="fc bfc" id="L646" title="All 2 branches covered.">        if (RandomUtils.nextFloat(0, 1) &lt; PATH_ABSOLUTE_P) {</span>
<span class="fc" id="L647">            return randomAbsoluteURI();</span>
        } else {
<span class="fc" id="L649">            return randomRelativeURI();</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>